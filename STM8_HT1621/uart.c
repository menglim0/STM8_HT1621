
/*************** (C) COPYRIGHT  EW工作室 ***************************************
 * 文件名  ：uart.c
 * 描述    ：串口调试文件   
 * 实验平台：EW STM8开发板 V1
 * 库版本  ：V2.1.0
 * 作者    ：EW  QQ：307298507
 * 公众微信：eworld2013
 * 修改时间：2013-07-20
*******************************************************************************/

/* 包含系统头文件 */

/* 包含自定义头文件 */
#include "uart.h"

/* 自定义新类型 */

/* 自定义宏 */

/* 自定义变量 */

/*实现函数部分*/


/*******************************************************************************
 * 名称: Uart_Init
 * 功能: UART2初始化操作
 * 形参: 无
 * 返回: 无
 * 说明: 无 
 ******************************************************************************/
void  UART2_Init(void)
{
    UART2_CR1=0x00;
    UART2_CR2=0x00;
    UART2_CR3=0x00;
    UART2_BRR2 = 0x01;
    UART2_BRR1 = 0x01;     //115200波特率
    UART2_CR2 = 0x2c;     //允许发送  允许接收 接收中断使能
}

void  UART2_Send(u8 dat)
{
    while((UART2_SR & 0x80)==0x00);
    UART2_DR = dat;
}


/*******************************************************************************
 * 名称: UART2_SendString
 * 功能: UART2发送len个字符
 * 形参: data -> 指向要发送的字符串
 *       len -> 要发送的字节数
 * 返回: 无
 * 说明: 无 
 ******************************************************************************/
void UART2_SendString(u8* Data)
{
	u16 i=0;
	//for(; i < len; i++)
        while(Data[i]!='\0')
        {
           UART2_Send(Data[i]);	/* 循环调用发送一个字符函数 */
           i++;
        }
		
}

/*******************************************************************************
 * 名称: void putchar(char ch)
 * 功能: 打印一个字符
 * 形参: 需要输出的字符
 * 返回: 无
 * 说明: 无

 ******************************************************************************/
void putchar(char ch)		// print normal characters or '\n'
{	  
	if('\n' == ch)
	{
		UART2_Send('\r');
	}

	UART2_Send(ch);

}

/*******************************************************************************
 * 名称: void printf_str(unsigned char *buffer)
 * 功能: 打印字符串
 * 形参: 需要打印的字符串首地址
 * 返回: 无
 * 说明: 例如   printf_str("this is a uart test");

 ******************************************************************************/
void printf_str(unsigned char *buffer)
{
	while (*buffer != '\0')
	{
	    putchar(*buffer++);
    }
}

/*******************************************************************************
 * 名称: void putascbase(unsigned char ch)
 * 功能: 将字符转换成ASIC输出
 * 形参: 需要打印的字符
 * 返回: 无
 * 说明: 比如我们输出16进制55，在串口调试助手没勾上16进制显示，
 					这时就用putascbase(0x55);

 ******************************************************************************/
void putascbase(unsigned char ch)
{
	 unsigned char i, j;//,k;
	 //for(k = 0; k<4 ;k++)
	 {
	     i = (ch>>4) & 0x0f;
	     j = ch & 0x0f;
	     if (i>9) i += 7;
	
	     if (j>9) j += 7;
	     putchar(i+0x30);
	     putchar(j+0x30);
     }

//	 printf("\n");
}

/*******************************************************************************
 * 名称: void putasc(unsigned char ch)
 * 功能: 将字符转换成ASIC输出，换行
 * 形参: 需要打印的字符
 * 返回: 无
 * 说明: 无

 ******************************************************************************/
void putasc(unsigned char ch)
{
	 putascbase(ch);
	 putchar(' ');
//	 printf("\n");
}

/*******************************************************************************
 * 名称: void putascLong(unsigned long ch)
 * 功能: 输出一个4字节长度的字符
 * 形参: 需要输出的字符
 * 返回: 无
 * 说明: 无

 ******************************************************************************/
void putascLong(unsigned long ch)
{
	 unsigned char i, j,k;
	 for(k = 0; k<4 ;k++)
	 {
	     i = (((u8 *)&ch)[k]>>4) & 0x0f;
	     j = ((u8 *)&ch)[k] & 0x0f;
	     if (i>9) i += 7;
	
	     if (j>9) j += 7;
	     putchar(i+0x30);
	     putchar(j+0x30);
     }
	 putchar(' ');

}
/*******************************************************************************
 * 名称: void putascShort(unsigned short ch)
 * 功能: 输出一个2字节长度的字符
 * 形参: 需要输出的字符
 * 返回: 无
 * 说明: 无 

 ******************************************************************************/
void putascShort(unsigned short ch)
{
	 putascbase(ch>>8);
	 putascbase(ch>>0);
	 putchar(' ');
//	 printf("\n");	 //*/
}
/*******************************************************************************
 * 名称: void printf_array(unsigned char *buffer, unsigned short  cnt) 
 * 功能: 输出数组
 * 形参: 数组首地址，长度
 * 返回: 无
 * 说明: 输出BUF[10]
 					printf_array(BUF,10);

 ******************************************************************************/
void printf_array(unsigned char *buffer, unsigned short  cnt) 
{
	u16 i;
	for(i=0; i< cnt; i++)
	{
		putasc(buffer[i]);
		if(((i+1)%16)==0)
		    putchar('\n');	 
	}
		  
}   //*/


/******************* (C) COPYRIGHT EW工作室 *****END OF FILE******************/